global
        maxconn 4096
        user haproxy
        group haproxy
        daemon
        log 127.0.0.1 local0 debug

defaults
        log     global
        mode    http
        option  httplog
        option  dontlognull
        retries 3
        option redispatch
        option http-server-close
        option forwardfor
        maxconn 2000
        timeout connect 5s
        timeout client  15min
        timeout server  15min

frontend public
        bind :::80 v4v6
        use_backend mjpgstreamer if { path_beg /mjpgstreamer/ }
        use_backend timelapse if { path_beg /timelapse/ }
        use_backend timelapse if { path_beg /static/tmp/timelapse }
        use_backend picam if { path_beg /picam/ }
        use_backend picam if { path_beg /static_picam/ }
        use_backend picam if { path_beg /api/v1.0/picam/ }

        default_backend main

backend main
        reqrep ^([^\ :]*)\ /(.*)     \1\ /\2
        option forwardfor
        server main1 127.0.0.1:5061

backend picam
        reqrep ^([^\ :]*)\ /picam/(.*)     \1\ /\2
        server picam1  127.0.0.1:5070

backend mjpgstreamer
        reqrep ^([^\ :]*)\ /mjpgstreamer/(.*)     \1\ /\2
        server mjpgstreamer1  127.0.0.1:9999

backend timelapse
        reqrep ^([^\ :]*)\ /timelapse/(.*)     \1\ /\2
        server timelapse1  127.0.0.1:5060
